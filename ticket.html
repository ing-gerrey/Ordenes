<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tickets ‚Äî Cocina</title>
<style>
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#0a1520; color:#e7f1ff;}
  header{padding:14px; text-align:center; background:#0c1624;}
  h1{margin:0; font-size:1.2rem}
  main{max-width:900px; margin:0 auto; padding:12px}
  .card{background:#0f1b2c; border:1px solid #203146; border-radius:12px; padding:10px; margin-bottom:10px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
  .who{min-width:140px; font-weight:700;}
  .opt{flex:1}
  .tag{display:inline-block; padding:2px 8px; border-radius:999px; font-size:.78rem; border:1px solid #2a3b53; background:#0c1a29}
  .papas{opacity:.9}
  .btn{border:0; padding:8px 10px; border-radius:10px; cursor:pointer; color:#fff; font-weight:700}
  .ok{background:#1e7b4f; border:1px solid #2ea46c}
  .warn{background:#8c1d25; border:1px solid #c53a44}
  .muted{opacity:.7}
</style>
</head>
<body>
<header>
  <h1>√ìrdenes registradas ‚Äî Cocina</h1>
  <div id="status" class="muted" style="margin-top:6px"></div>
</header>
<main>
  <div id="lista"></div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import {
    getFirestore, collection, onSnapshot, query, orderBy, updateDoc, doc
  } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDkzW3BnlnhDXf2naDEsjx-zouCQw1AJ9c",
    authDomain: "ordenes-b0c4c.firebaseapp.com",
    projectId: "ordenes-b0c4c",
    storageBucket: "ordenes-b0c4c.appspot.com",
    messagingSenderId: "168920201545",
    appId: "1:168920201545:web:7a8e53c3e34e28e7508298",
    measurementId: "G-RSG46R8W8C"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const $lista = document.getElementById('lista');
  const $status = document.getElementById('status');

  function render(docId, data){
    const estado = data.estado || 'pendiente';
    const div = document.createElement('div');
    div.className = 'card';
    div.id = 'o_'+docId;

    const who = document.createElement('div');
    who.className = 'who';
    who.textContent = data.nombre;

    const opt = document.createElement('div');
    opt.className = 'opt';
    const papas = data.papas ? 'üçü' : '‚Äî';
    opt.innerHTML = `<strong>${data.opcion}</strong> <span class="papas">${papas}</span> ‚Ä¢ <span class="tag">${estado}</span>`;

    const bListo = document.createElement('button');
    bListo.className='btn ok';
    bListo.textContent='Listo';
    bListo.onclick = async ()=> {
      await updateDoc(doc(db,'ordenes',docId), { estado:'listo' });
    };

    const bAgotado = document.createElement('button');
    bAgotado.className='btn warn';
    bAgotado.textContent='Opci√≥n agotada (pida otra) üî¥';
    bAgotado.title='Marca que esta opci√≥n ya no est√° disponible';
    bAgotado.onclick = async ()=> {
      await updateDoc(doc(db,'ordenes',docId), { estado:'agotado' });
    };

    div.appendChild(who);
    div.appendChild(opt);
    if (estado === 'pendiente'){
      div.appendChild(bListo);
      div.appendChild(bAgotado);
    }
    return div;
  }

  // Suscripci√≥n en tiempo real
  onSnapshot(query(collection(db,'ordenes'), orderBy('fecha','asc')), (snap)=>{
    $lista.innerHTML = '';
    if (snap.empty){ $lista.innerHTML = '<div class="muted">No hay √≥rdenes a√∫n.</div>'; return; }
    snap.forEach(d=>{
      $lista.appendChild( render(d.id, d.data()) );
    });
    $status.textContent = `Total: ${snap.size}`;
  }, (err)=>{
    $status.textContent = 'Error: ' + err.message;
  });
</script>
</body>
</html>
